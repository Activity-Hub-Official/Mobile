<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Activity Hub PWA</title>

  <!-- PWA manifest & meta -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="https://i.imgur.com/DNoJrbI.png" />
  <link rel="icon" href="https://i.imgur.com/DNoJrbI.png" />

  <!-- Tailwind & Font Awesome -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
  />

  <style>
    /* Disable bounce & pinch-zoom */
    html, body {
      height: 100%;
      overflow: hidden;
      overscroll-behavior: none;
      touch-action: manipulation;
      background: #000;
    }
    /* Sidebar off-canvas */
    #sidebar {
      position: fixed; top:0; left:0; bottom:0;
      width:16rem;
      transform:translateX(-100%);
      transition:transform .3s;
      z-index:60;
      background:#2d3748;
      padding:calc(env(safe-area-inset-top)+1rem) 1rem 1rem;
      display:flex; flex-direction:column;
    }
    #sidebar.open { transform:translateX(0); }
    #sidebarOverlay {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.5); z-index:55;
      display:none;
    }
    /* Listings: smooth, momentum scroll + spacing */
    #listings {
      flex:1; width:100%; overflow-y:auto;
      scroll-behavior:smooth;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;
      margin-top:4rem; padding:0 1rem 4rem;
      display:flex; flex-direction:column; gap:1rem;
    }
    .bar { background:#000; z-index:50; }
  </style>
</head>
<body class="relative text-white h-screen overflow-hidden">

  <div id="sidebarOverlay" onclick="closeSidebar()"></div>

  <aside id="sidebar">
    <div class="flex items-center space-x-3 mb-4">
      <img src="https://i.imgur.com/zGz4RR3.jpeg" class="w-10 h-10 rounded-full" />
      <div class="flex-1">
        <p class="font-medium">Saeed Khan</p>
        <button class="text-xs text-gray-400 hover:text-gray-200 mt-1" onclick="editProfile()">Edit Profile</button>
      </div>
    </div>
    <hr class="border-gray-700 my-2"/>
    <button class="flex items-center w-full py-2 hover:bg-gray-700 rounded"><i class="fa-solid fa-star mr-3"></i>Activities Being Followed</button>
    <hr class="border-gray-700 my-2"/>
    <button class="flex items-center w-full py-2 hover:bg-gray-700 rounded">
      <i class="fa-solid fa-clipboard-list mr-3"></i>Your Activities
      <span class="ml-auto text-xs bg-blue-600 px-2 py-0.5 rounded-full">Admin</span>
    </button>
    <hr class="border-gray-700 my-2"/>
    <button class="flex items-center w-full py-2 hover:bg-gray-700 rounded"><i class="fa-solid fa-qrcode mr-3"></i>QR Code Sign-In</button>
    <hr class="border-gray-700 my-2"/>
    <button class="flex items-center w-full py-2 hover:bg-gray-700 rounded"><i class="fa-solid fa-cog mr-3"></i>Settings</button>
    <button class="flex items-center w-full py-2 hover:bg-gray-700 rounded"><i class="fa-solid fa-circle-question mr-3"></i>Help Center</button>
    <button class="flex items-center w-full py-2 hover:bg-gray-700 rounded mt-auto"><i class="fa-solid fa-sign-out-alt mr-3"></i>Logout</button>
  </aside>

  <div id="pwaShell" class="hidden absolute inset-0 flex flex-col items-center justify-start h-screen overflow-hidden">

    <!-- Top Bar (sticky) -->
    <div class="bar fixed top-0 left-0 right-0 flex items-center space-x-2 p-4"
         style="padding-top: env(safe-area-inset-top);">
      <img src="https://i.imgur.com/zGz4RR3.jpeg" class="w-8 h-8 rounded-full cursor-pointer" onclick="openSidebar()"/>
      <div class="relative flex-1">
        <input id="searchInput" list="categoryList" type="search" placeholder="Searchâ€¦"
               class="w-full pl-10 pr-3 py-2 rounded-full bg-gray-800 text-white placeholder-gray-400 focus:outline-none"/>
        <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        <datalist id="categoryList">
          <option value="Clubs & Orgs">
          <option value="Business">
          <option value="Other Projects">
          <option value="Event">
        </datalist>
      </div>
      <button class="text-gray-400 hover:text-white p-2"><i class="fa-solid fa-pen-to-square text-2xl"></i></button>
    </div>

    <!-- Listings -->
    <div id="listings" class="w-full max-w-md"></div>

    <!-- Bottom Tabs (sticky) -->
    <nav class="bar fixed bottom-0 left-0 right-0 flex justify-around py-3"
         style="padding-bottom: env(safe-area-inset-bottom);">
      <button onclick="showHome()" class="flex flex-col items-center text-gray-400 hover:text-white">
        <i class="fa-solid fa-home text-xl"></i><span class="text-xs mt-1">Home</span>
      </button>
      <button onclick="showCategory('Clubs & Orgs')" class="flex flex-col items-center text-gray-400 hover:text-white">
        <i class="fa-solid fa-users text-xl"></i><span class="text-xs mt-1">Clubs</span>
      </button>
      <button onclick="showCategory('Business')" class="flex flex-col items-center text-gray-400 hover:text-white">
        <i class="fa-solid fa-briefcase text-xl"></i><span class="text-xs mt-1">Businesses</span>
      </button>
      <button onclick="showCategory('Other Projects')" class="flex flex-col items-center text-gray-400 hover:text-white">
        <i class="fa-solid fa-folder-open text-xl"></i><span class="text-xs mt-1">Projects</span>
      </button>
      <button onclick="showCategory('Event')" class="flex flex-col items-center text-gray-400 hover:text-white">
        <i class="fa-solid fa-calendar-alt text-xl"></i><span class="text-xs mt-1">Events</span>
      </button>
    </nav>
  </div>

  <div id="mainContent" class="flex flex-col items-center justify-between w-full max-w-sm mx-auto h-screen p-4 overflow-hidden">
    <header class="text-center mt-8">
      <h1 class="text-3xl font-bold leading-tight">Discover, Connect, & Launch<br/>Your Campus Journey</h1>
      <p class="mt-3 text-gray-300 text-sm">Try the new mobile experience of Activity Hub</p>
    </header>
    <div class="my-8">
      <img src="https://via.placeholder.com/250x500?text=Activity+Hub+Preview"
           class="rounded-xl shadow-xl max-w-[250px]" />
    </div>
    <div class="w-full text-center">
      <button onclick="showOverlay()"
              class="bg-blue-600 hover:bg-blue-700 transition duration-200 text-white font-semibold py-3 px-6 rounded-full text-lg shadow-lg">
        Try Activity Hub Now
      </button>
      <p class="mt-3 text-sm text-gray-400">No download needed. Works right in your browser.</p>
    </div>
    <footer class="mt-12 text-xs text-gray-500 text-center">&copy; 2025 Activity Hub. All rights reserved.</footer>
  </div>

  <div id="installOverlay" class="hidden fixed inset-0 bg-black bg-opacity-90 text-white flex flex-col justify-between items-center p-6 z-30 h-screen overflow-hidden">
    <div class="max-w-sm text-center mt-16">
      <i class="fa-solid fa-arrow-up-from-bracket text-4xl mb-4 text-blue-400"></i>
      <h2 class="text-2xl font-semibold mb-3">Add to Home Screen</h2>
      <p class="text-sm mb-6 text-gray-300 leading-relaxed">
        Tap the <i class="fa-solid fa-arrow-up-from-bracket text-lg text-white"></i> icon at the bottom of your Safari screen.<br/><br/>
        Then scroll down and tap <strong>"Add to Home Screen"</strong>, then hit <strong>Add</strong>.
      </p>
    </div>
    <div onclick="hideOverlay()" class="cursor-pointer animate-bounce mb-8" title="Close">
      <i class="fa-solid fa-arrow-up-from-bracket text-3xl text-gray-400 hover:text-white transition-colors duration-300"></i>
    </div>
  </div>

  <script>
    let allProjects = [];

    const isStandalone = window.matchMedia('(display-mode: standalone)').matches
                      || window.navigator.standalone === true;

    window.addEventListener('load', () => {
      if (isStandalone) {
        document.getElementById('mainContent').classList.add('hidden');
        document.getElementById('pwaShell').classList.remove('hidden');
        fetchProjects().then(() => {
          showHome();
          attachSearchHandlers();
        });
      }
    });

    async function fetchProjects() {
      try {
        const res = await fetch('https://sheet2api.com/v1/an4oVvpQR51V/mock-data-new');
        allProjects = await res.json();
      } catch (e) {
        console.error('Failed to fetch projects', e);
      }
    }

    function createCard(p) {
      const div = document.createElement('div');
      div.className = 'bg-gray-900 rounded-lg p-4 flex space-x-4';
      div.innerHTML = `
        <img src="${p['Logo URL']}" alt="${p['Project Title']}" class="w-16 h-16 object-cover rounded"/>
        <div class="flex-1">
          <h3 class="text-white font-semibold">${p['Project Title']}</h3>
          <p class="text-gray-400 text-sm">${p.Tagline}</p>
          <a href="${p['Demo Link']}" target="_blank" class="inline-block mt-2 text-blue-500 text-sm hover:underline">
            ${p['Call to Action']}
          </a>
        </div>`;
      return div;
    }

    function showHome() {
      const groups = [
        { title: 'Clubs', key: 'Clubs & Orgs' },
        { title: 'Businesses', key: 'Business' },
        { title: 'Projects', key: 'Other Projects' }
      ];
      const container = document.getElementById('listings');
      container.innerHTML = '';
      groups.forEach(g => {
        const h = document.createElement('h2');
        h.className = 'text-xl font-bold mt-4 mb-2 px-1';
        h.textContent = g.title;
        container.appendChild(h);
        allProjects
          .filter(p => p['Project Type'] === g.key)
          .slice(0, 3)
          .forEach(p => container.appendChild(createCard(p)));
      });
    }

    function showCategory(typeKey) {
      const titleMap = {
        'Clubs & Orgs': 'Clubs',
        'Business': 'Businesses',
        'Other Projects': 'Projects',
        'Event': 'Events'
      };
      const container = document.getElementById('listings');
      container.innerHTML = '';
      const h = document.createElement('h2');
      h.className = 'text-xl font-bold mt-4 mb-2 px-1';
      h.textContent = titleMap[typeKey] || typeKey;
      container.appendChild(h);
      allProjects
        .filter(p => p['Project Type'] === typeKey)
        .forEach(p => container.appendChild(createCard(p)));
    }

    function attachSearchHandlers() {
      const input = document.getElementById('searchInput');
      input.addEventListener('input', applySearchFilter);
    }

    function applySearchFilter() {
      const term = document.getElementById('searchInput').value.trim();
      const container = document.getElementById('listings');
      container.innerHTML = '';

      // if exactly one of our categories, treat as category filter
      const categories = ['Clubs & Orgs','Business','Other Projects','Event'];
      if (categories.includes(term)) {
        showCategory(term);
        return;
      }

      // otherwise full-text search
      const filtered = allProjects.filter(p => {
        const t = term.toLowerCase();
        return p['Project Title'].toLowerCase().includes(t)
            || p.Tagline.toLowerCase().includes(t)
            || p.Description.toLowerCase().includes(t);
      });
      filtered.forEach(p => container.appendChild(createCard(p)));
    }

    function openSidebar() {
      document.getElementById('sidebar').classList.add('open');
      document.getElementById('sidebarOverlay').style.display = 'block';
    }
    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').style.display = 'none';
    }

    function showOverlay() {
      document.getElementById('installOverlay').classList.remove('hidden');
    }
    function hideOverlay() {
      document.getElementById('installOverlay').classList.add('hidden');
    }

    function editProfile() {
      alert('Edit Profile clicked');
    }
  </script>
</body>
</html>
